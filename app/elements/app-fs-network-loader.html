<polymer-element name="app-fs-network-loader" attributes="rootDir">
    <template></template>
    <script>
        (function(){
            var fs = require('fs');

            Polymer('app-fs-network-loader', {
                rootDir : '',

                run : function(callback) {
                    if( !this.rootDir ) return;

                    var data = {
                        nodes : [],
                        links : []
                    };

                    var nodes = fs.readdirSync(this.rootDir+'/data/nodes');
                    for(var i = 0; i < nodes.length; i++ ) {
                        var jsonFile = this.rootDir+'/data/nodes/'+nodes[i]+'/node.geojson';
                        if( !fs.existsSync(jsonFile) ) continue;

                        var str = fs.readFileSync(jsonFile);
                        data.nodes.push(JSON.parse(str));
                    }

                    var links = fs.readdirSync(this.rootDir+'/data/links');
                    for(var i = 0; i < links.length; i++ ) {
                        var jsonFile = this.rootDir+'/data/links/'+links[i]+'/link.geojson';
                        if( !fs.existsSync(jsonFile) ) continue;

                        var str = fs.readFileSync(jsonFile);
                        data.links.push(JSON.parse(str));
                    }

                    callback(data);
                }
            });
        })();
    </script>
</polymer-element>